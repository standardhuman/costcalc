<!DOCTYPE html>
<html>
<head>
    <title>Test Admin</title>
</head>
<body>
    <h1>Test Admin Page</h1>
    <button id="chargeButton" disabled>Charge Customer</button>
    <div id="chargeDetails">No service selected</div>

    <script>
        // Stub that should be replaced
        window.updateChargeSummary = function() {
            console.log('STUB: updateChargeSummary called');
        };

        window.currentServiceKey = null;
    </script>

    <script type="module">
        try {
            console.log('Module script starting');

            // Define real updateChargeSummary
            function updateChargeSummary() {
                console.log('REAL: updateChargeSummary called');
                const button = document.getElementById('chargeButton');
                const details = document.getElementById('chargeDetails');

                if (window.currentServiceKey) {
                    button.disabled = false;
                    details.textContent = 'Service: ' + window.currentServiceKey;
                } else {
                    button.disabled = true;
                    details.textContent = 'No service selected';
                }
            }

            // Replace stub with real function
            window.updateChargeSummary = updateChargeSummary;
            console.log('Real function installed');

            // Test it
            window.currentServiceKey = 'test_service';
            updateChargeSummary();

            console.log('Module script completed');
        } catch (err) {
            console.error('Module script error:', err);
        }
    </script>
</body>
</html>