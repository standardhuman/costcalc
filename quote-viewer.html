<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quote Viewer | Sailor Skills</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .quote-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .quote-header {
            background: linear-gradient(135deg, #2962ff 0%, #2979ff 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .company-name {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .quote-title {
            font-size: 20px;
            font-weight: 400;
            opacity: 0.95;
        }

        .quote-body {
            padding: 40px;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #2962ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            text-align: center;
            padding: 60px;
            color: #d32f2f;
        }

        .quote-info {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .quote-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .quote-info-row:last-child {
            margin-bottom: 0;
        }

        .info-label {
            font-weight: 600;
            color: #666;
        }

        .info-value {
            color: #333;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: #666;
        }

        .detail-value {
            color: #333;
            font-weight: 500;
        }

        .pricing-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding-top: 15px;
            margin-top: 15px;
            border-top: 2px solid #333;
            font-size: 20px;
            font-weight: 700;
        }

        .total-label {
            color: #333;
        }

        .total-value {
            color: #2962ff;
        }

        .quote-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e0e0e0;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #2962ff;
            color: white;
        }

        .btn-primary:hover {
            background: #2979ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 98, 255, 0.3);
        }

        .btn-secondary {
            background: #757575;
            color: white;
        }

        .btn-secondary:hover {
            background: #616161;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .quote-footer {
            text-align: center;
            padding: 20px;
            background: #f5f5f5;
            color: #666;
            font-size: 12px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-sent {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-viewed {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-accepted {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-rejected {
            background: #ffebee;
            color: #c62828;
        }

        .anodes-list {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .anode-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .quote-body {
                padding: 20px;
            }

            .quote-info-row,
            .detail-row {
                flex-direction: column;
                gap: 5px;
            }

            .quote-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="quote-container">
        <div class="quote-header">
            <div class="company-name">SAILOR SKILLS</div>
            <div class="quote-title">SERVICE QUOTE</div>
        </div>

        <div class="quote-body" id="quoteContent">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div>Loading quote...</div>
            </div>
        </div>
    </div>

    <script>
        async function loadQuote() {
            const quoteContent = document.getElementById('quoteContent');

            // Get quote number from URL
            const pathParts = window.location.pathname.split('/');
            const quoteNumber = pathParts[pathParts.length - 1];

            if (!quoteNumber) {
                quoteContent.innerHTML = '<div class="error">Invalid quote URL</div>';
                return;
            }

            try {
                // Fetch quote from API
                const response = await fetch(`/api/quotes/${quoteNumber}`);
                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Quote not found');
                }

                const quote = data.quote;
                displayQuote(quote);

            } catch (error) {
                console.error('Error loading quote:', error);
                quoteContent.innerHTML = `
                    <div class="error">
                        <h3>Quote Not Found</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function displayQuote(quote) {
            const quoteContent = document.getElementById('quoteContent');

            // Format dates
            const quoteDate = new Date(quote.quote_date).toLocaleDateString();
            const expiryDate = new Date(quote.expiry_date).toLocaleDateString();

            // Build anodes HTML if present
            let anodesHTML = '';
            if (quote.anodes && quote.anodes.length > 0) {
                const anodesList = quote.anodes.map(anode => `
                    <div class="anode-item">
                        <span>${anode.quantity}x ${anode.name}</span>
                        <span>$${anode.totalPrice.toFixed(2)}</span>
                    </div>
                `).join('');

                anodesHTML = `
                    <div class="section">
                        <h3 class="section-title">Zinc Anodes</h3>
                        <div class="anodes-list">
                            ${anodesList}
                        </div>
                    </div>
                `;
            }

            // Determine status badge
            const statusClass = `status-${quote.status || 'sent'}`;
            const statusText = quote.status || 'sent';

            quoteContent.innerHTML = `
                <div class="quote-info">
                    <div class="quote-info-row">
                        <span class="info-label">Quote Number:</span>
                        <span class="info-value">${quote.quote_number}</span>
                    </div>
                    <div class="quote-info-row">
                        <span class="info-label">Date:</span>
                        <span class="info-value">${quoteDate}</span>
                    </div>
                    <div class="quote-info-row">
                        <span class="info-label">Valid Until:</span>
                        <span class="info-value">${expiryDate}</span>
                    </div>
                    <div class="quote-info-row">
                        <span class="info-label">Status:</span>
                        <span class="info-value">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </span>
                    </div>
                </div>

                <div class="section">
                    <h3 class="section-title">Customer Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span>
                        <span class="detail-value">${quote.customer_name}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value">${quote.customer_email}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span>
                        <span class="detail-value">${quote.customer_phone || 'N/A'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Boat:</span>
                        <span class="detail-value">${quote.boat_name || 'N/A'}</span>
                    </div>
                    ${quote.boat_make ? `
                        <div class="detail-row">
                            <span class="detail-label">Make/Model:</span>
                            <span class="detail-value">${quote.boat_make}</span>
                        </div>
                    ` : ''}
                    ${quote.marina ? `
                        <div class="detail-row">
                            <span class="detail-label">Marina:</span>
                            <span class="detail-value">${quote.marina}</span>
                        </div>
                    ` : ''}
                    ${quote.slip ? `
                        <div class="detail-row">
                            <span class="detail-label">Slip:</span>
                            <span class="detail-value">${quote.slip}</span>
                        </div>
                    ` : ''}
                </div>

                <div class="section">
                    <h3 class="section-title">Service Details</h3>
                    <div class="detail-row">
                        <span class="detail-label">Service Type:</span>
                        <span class="detail-value">${quote.service_name || 'N/A'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Boat Length:</span>
                        <span class="detail-value">${quote.boat_length} ft</span>
                    </div>
                    ${quote.paint_condition ? `
                        <div class="detail-row">
                            <span class="detail-label">Paint Condition:</span>
                            <span class="detail-value">${quote.paint_condition}</span>
                        </div>
                    ` : ''}
                    ${quote.growth_level ? `
                        <div class="detail-row">
                            <span class="detail-label">Growth Level:</span>
                            <span class="detail-value">${quote.growth_level}</span>
                        </div>
                    ` : ''}
                    ${quote.has_twin_engines ? `
                        <div class="detail-row">
                            <span class="detail-label">Twin Engines:</span>
                            <span class="detail-value">Yes</span>
                        </div>
                    ` : ''}
                    ${quote.additional_hulls > 0 ? `
                        <div class="detail-row">
                            <span class="detail-label">Additional Hulls:</span>
                            <span class="detail-value">${quote.additional_hulls}</span>
                        </div>
                    ` : ''}
                </div>

                ${anodesHTML}

                <div class="pricing-section">
                    <h3 class="section-title">Pricing Breakdown</h3>
                    ${quote.base_price > 0 ? `
                        <div class="detail-row">
                            <span class="detail-label">Service (${quote.boat_length}ft × $${quote.rate_per_foot}/ft):</span>
                            <span class="detail-value">$${quote.base_price.toFixed(2)}</span>
                        </div>
                    ` : ''}
                    ${quote.anode_cost > 0 ? `
                        <div class="detail-row">
                            <span class="detail-label">Anodes:</span>
                            <span class="detail-value">$${quote.anode_cost.toFixed(2)}</span>
                        </div>
                    ` : ''}
                    ${quote.anode_labor_cost > 0 ? `
                        <div class="detail-row">
                            <span class="detail-label">Anode Installation:</span>
                            <span class="detail-value">$${quote.anode_labor_cost.toFixed(2)}</span>
                        </div>
                    ` : ''}
                    <div class="total-row">
                        <span class="total-label">TOTAL:</span>
                        <span class="total-value">$${quote.total_cost.toFixed(2)}</span>
                    </div>
                </div>

                <div class="quote-actions">
                    <button class="btn btn-success" onclick="acceptQuote('${quote.quote_number}')">
                        ✓ Accept Quote
                    </button>
                    <button class="btn btn-primary" onclick="downloadPDF('${quote.quote_number}')">
                        📥 Download PDF
                    </button>
                    <button class="btn btn-secondary" onclick="contactUs('${quote.quote_number}')">
                        📧 Contact Us
                    </button>
                </div>

                <div class="quote-footer">
                    <p>This quote is valid until ${expiryDate}.</p>
                    <p>Terms and conditions apply. Payment due upon completion of service.</p>
                </div>
            `;
        }

        function acceptQuote(quoteNumber) {
            if (confirm('Would you like to accept this quote and schedule your service?')) {
                window.location.href = `/booking?quote=${quoteNumber}`;
            }
        }

        function downloadPDF(quoteNumber) {
            // This would trigger PDF generation
            alert('PDF download will be available soon');
        }

        function contactUs(quoteNumber) {
            window.location.href = `mailto:info@sailorskills.com?subject=Question about Quote ${quoteNumber}`;
        }

        // Load quote when page loads
        document.addEventListener('DOMContentLoaded', loadQuote);
    </script>
</body>
</html>