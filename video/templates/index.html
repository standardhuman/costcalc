<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B.O.A.T.Y. - Boat Organizer & Automated Transfer to YouTube | Sailor Skills</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css', v=version) }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/rename-preview.css', v=version) }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <span class="boaty-logo">B.O.A.T.Y.</span>
                <span class="boaty-acronym">Boat Organizer & Automated Transfer to YouTube</span>
                <span class="boaty-creator">by Sailor Skills</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-toggle="modal" data-target="#settingsModal">Settings</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-12">
                <!-- Global Alert Container (for app-wide alerts) -->
                <div id="alert-container" class="mt-4"></div>
                
                <!-- Workflow Breadcrumb Navigation -->
                <div class="workflow-breadcrumb d-flex justify-content-between mb-3">
                    <div class="breadcrumb-item active" data-step="1">1. Add Source Videos</div>
                    <div class="breadcrumb-item" data-step="2">2. Rename Videos</div>
                    <div class="breadcrumb-item" data-step="3">3. Upload to YouTube</div>
                </div>
                <!-- Folder Access Buttons -->
                <div class="mb-4">
                    <button id="open-downloads-folder" class="btn btn-outline-secondary mr-2"><i class="fas fa-folder-open"></i> Downloads Folder</button>
                    <button id="open-source-folder" class="btn btn-outline-secondary mr-2"><i class="fas fa-folder-open"></i> Source Folder</button>
                    <button id="open-upload-folder" class="btn btn-outline-secondary mr-2"><i class="fas fa-folder-open"></i> Upload Folder</button>
                    <button id="open-archive-folder" class="btn btn-outline-secondary"><i class="fas fa-folder-open"></i> Archive Folder</button>
                </div>
                
                <!-- Workflow Content (without tabs) -->
                <div class="workflow-container">
                    <!-- Step 1: Add Source Videos -->
                    <div class="workflow-section mt-4" id="source-videos-section">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="workflow-step mb-0" data-step="1">Step 1: Add Source Videos</h3>
                            </div>
                            <div class="card-body">
                                <!-- Status message container for Step 1 -->
                                <div class="step-alert-container" id="step1-alert-container"></div>
                                
                                <!-- Drag & Drop Area -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        Add Source Videos
                                    </div>
                                    <div class="card-body">
                                        <div id="dropzone" class="dropzone-area text-center">
                                            <div class="dropzone-content">
                                                <i class="fas fa-cloud-upload-alt fa-3x mb-3"></i>
                                                <p>Drag and drop video files here<br>or</p>
                                                <input type="file" id="file-input" multiple accept="video/*" class="d-none">
                                                <button id="select-files-btn" class="btn btn-outline-primary">Select Files</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Source Videos List -->
                                <h4 class="mb-3">Available Source Videos</h4>
                                <div id="bulk-actions-toolbar"></div>
                                <div id="video-filter-controls" class="mb-3">
                                    <div class="form-inline">
                                        <div class="form-group mr-3">
                                            <label for="size-filter-min" class="mr-2">Min Size (MB):</label>
                                            <input type="number" class="form-control" id="size-filter-min" min="0" step="0.1" value="1">
                                        </div>
                                        <div class="form-group mr-3">
                                            <label for="size-filter-max" class="mr-2">Max Size (MB):</label>
                                            <input type="number" class="form-control" id="size-filter-max" min="0" step="1" value="500">
                                        </div>
                                        <button id="apply-filter-btn" class="btn btn-primary mr-2">Apply Filter</button>
                                        <button id="clear-filter-btn" class="btn btn-secondary">Clear Filter</button>
                                    </div>
                                </div>
                                <div id="source-video-list">
                                    <div class="text-center p-4">
                                        <div class="spinner-border" role="status">
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                        <p class="mt-2">Loading videos...</p>
                                    </div>
                                </div>
                                <!-- Next Step Button -->
                                <div class="text-right mt-3">
                                    <button id="next-to-rename-btn" class="btn btn-primary">
                                        Next: Rename Videos <i class="fas fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 2: Rename Videos -->
                    <div class="workflow-section mt-5" id="rename-section">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="workflow-step mb-0" data-step="2">Step 2: Rename Videos</h3>
                            </div>
                            <div class="card-body">
                                <!-- Status message container for Step 2 -->
                                <div class="step-alert-container" id="step2-alert-container"></div>
                                
                                <!-- Rename Form -->
                                <div class="card">
                                    <div class="card-header">
                                        Rename Videos
                                    </div>
                                    <div class="card-body">
                                        <form id="rename-form">
                                            <!-- Date Selection -->
                                            <div class="form-group">
                                                <label for="selected-date">Date:</label>
                                                <input type="date" class="form-control" id="selected-date">
                                            </div>

                                            <!-- Boat Names -->
                                            <div class="form-group">
                                                <label for="boat-names-textarea">Boat Names (one per line or comma-separated)</label>
                                                <textarea class="form-control" id="boat-names-textarea" rows="5" placeholder="Enter boat names, e.g.\nMV Boaty\nMS McBoatface\nSea Explorer"></textarea>
                                                <small class="form-text text-muted">Paste your list of boat names here.</small>
                                            </div>
                                            <!-- Removed Boat Name List and Add Button -->
                                            <!-- <div id="boat-name-list"> -->
                                                <!-- Existing boat name inputs will be dynamically added here -->
                                            <!-- </div> -->
                                            <!-- <button type="button" id="add-boat-button" class="btn btn-outline-secondary btn-sm mt-2"><i class="fas fa-plus"></i> Add Boat</button> -->
                                            <!-- End Boat Names -->

                                            <!-- Videos per Boat -->
                                            <div class="form-group">
                                                <label for="videos-per-boat">Videos per Boat:</label>
                                                <input type="number" class="form-control" id="videos-per-boat" min="1" value="2">
                                            </div>
                                            
                                            <!-- Custom Suffix Container (displays when videos_per_boat > 2) -->
                                            <div id="custom-suffix-container" class="custom-suffix-inputs" style="display: none;"></div>
                                            
                                            <!-- Video Purpose Selection (displays when videos_per_boat > 2) -->
                                            <div id="video-purpose-container" class="mt-3" style="display: none;">
                                                <h5>Video Purpose Selection</h5>
                                                <p class="text-muted">Select common purposes for videos or enter custom descriptions.</p>
                                                <div class="form-group">
                                                    <label for="purpose-template">Common Video Purposes:</label>
                                                    <select class="form-control" id="purpose-template">
                                                        <option value="">Select a purpose...</option>
                                                        <option value="Propeller Removal">Propeller Removal</option>
                                                        <option value="Propeller Installation">Propeller Installation</option>
                                                        <option value="Anode Installation">Anode Installation</option>
                                                        <option value="Line Removal">Line Removal</option>
                                                        <option value="Item Recovery">Item Recovery</option>
                                                        <option value="Inspection">Inspection</option>
                                                    </select>
                                                    <small class="form-text text-muted">Select a purpose to apply to the selected video number below</small>
                                                </div>
                                                <div class="form-group">
                                                    <label for="purpose-video-number">Apply to Video Number:</label>
                                                    <select class="form-control" id="purpose-video-number">
                                                        <!-- Will be populated dynamically -->
                                                    </select>
                                                </div>
                                                <button type="button" id="apply-purpose-btn" class="btn btn-secondary">Apply Purpose</button>
                                            </div>
                                            
                                            <!-- Action Buttons -->
                                            <div class="form-row mt-3">
                                                <div class="col">
                                                    <button type="button" class="btn btn-info btn-block" id="preview-rename-btn">Preview Rename</button>
                                                </div>
                                                <div class="col">
                                                    <button type="submit" class="btn btn-primary btn-block" id="quick-rename-btn">
                                                        <span id="rename-spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                                                        Quick Rename
                                                    </button>
                                                </div>
                                                <div class="col">
                                                    <button type="button" class="btn btn-secondary btn-block" id="undo-rename-button">Undo Rename</button>
                                                </div>
                                            </div>
                                        </form>
                                        
                                        <!-- Rename Preview Section -->
                                        <div id="rename-preview-section" style="display: none;" class="mt-4">
                                            <h5>Rename Preview</h5>
                                            <p class="text-muted">Review and edit individual video assignments. Drag rows to reorder.</p>
                                            
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover" id="rename-preview-table">
                                                    <thead>
                                                        <tr>
                                                            <th width="30"></th>
                                                            <th>Source Video</th>
                                                            <th>Boat Name</th>
                                                            <th>Date</th>
                                                            <th>Type</th>
                                                            <th>Final Name</th>
                                                            <th width="80">Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="rename-preview-tbody">
                                                        <!-- Preview rows will be inserted here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <!-- Unassigned Videos -->
                                            <div id="unassigned-videos-section" style="display: none;" class="mt-3">
                                                <h6>Unassigned Videos</h6>
                                                <div class="alert alert-warning">
                                                    <p class="mb-2">The following videos were not assigned to any boat:</p>
                                                    <ul id="unassigned-videos-list" class="mb-2"></ul>
                                                    <button type="button" class="btn btn-sm btn-warning" id="add-boat-for-unassigned">Add New Boat</button>
                                                </div>
                                            </div>
                                            
                                            <!-- Preview Action Buttons -->
                                            <div class="form-row mt-3">
                                                <div class="col">
                                                    <button type="button" class="btn btn-success btn-block" id="apply-rename-btn">Apply Rename</button>
                                                </div>
                                                <div class="col">
                                                    <button type="button" class="btn btn-secondary btn-block" id="cancel-preview-btn">Cancel</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 3: Upload to YouTube -->
                    <div class="workflow-section mt-5" id="upload-section">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="workflow-step mb-0" data-step="3">Step 3: Upload to YouTube</h3>
                            </div>
                            <div class="card-body">
                                <!-- Status message container for Step 3 -->
                                <div class="step-alert-container" id="step3-alert-container"></div>
                                
                                <!-- Upload Form -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        Upload to YouTube
                                    </div>
                                    <div class="card-body">
                                        <form id="upload-form">
                                            <div class="form-group">
                                                <p class="text-muted">After renaming videos, a preview will be automatically generated. Review the details below before uploading.</p>
                                                <div id="upload-button-container" class="mt-3"></div>

                                                <!-- Collapsible Upload Preview Report -->
                                                <div id="upload-preview-report-section" class="card mt-4" style="display: none;">
                                                    <div class="card-header">
                                                        <h5 class="mb-0">
                                                            <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapsePreviewReport" aria-expanded="true" aria-controls="collapsePreviewReport">
                                                                Upload Preview Report
                                                            </button>
                                                        </h5>
                                                    </div>
                                                    <div id="collapsePreviewReport" class="collapse show">
                                                        <div class="card-body" id="upload-preview-report-content">
                                                            <!-- Preview content will be injected here by JavaScript -->
                                                            <p class="text-muted">Click "Preview Upload" to generate the report.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- End Collapsible Upload Preview Report -->
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                
                                <!-- Upload Ready Videos List -->
                                <h4 class="mb-3">Ready for Upload</h4>
                                <div id="upload-ready-list">
                                    <div class="text-center p-4">
                                        <div class="spinner-border" role="status">
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                        <p class="mt-2">Loading videos...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p><strong>B.O.A.T.Y.</strong> - Boat Organizer & Automated Transfer to YouTube | <span class="footer-creator">by Sailor Skills</span></p>
            <p class="version-info">Version {{ app_version }} | Last Updated: {{ last_updated }}</p>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Settings</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Directory Settings -->
                    <div class="settings-section">
                        <h4>Directory Paths</h4>
                        <form id="directory-settings-form">
                            <div class="form-group">
                                <label for="source-dir">Source Directory:</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="source-dir" value="{{ source_dir }}">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" id="browse-source-btn">Browse...</button>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="upload-dir">Upload Directory:</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="upload-dir" value="{{ upload_dir }}">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" id="browse-upload-btn">Browse...</button>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="archive-dir">Archive Directory:</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="archive-dir" value="{{ archive_dir }}">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" id="browse-archive-btn">Browse...</button>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Save Directory Settings</button>
                            </div>
                        </form>
                        <div id="settings-alert" class="mt-3" style="display: none;"></div>
                    </div>
                    
                    <!-- YouTube Settings -->
                    <div class="settings-section">
                        <h4>YouTube Settings</h4>
                        <form id="youtube-settings-form">
                            <div class="form-group">
                                <label for="privacy-setting">Default Privacy:</label>
                                <select class="form-control" id="privacy-setting">
                                    <option value="private" {% if youtube_privacy == 'private' %}selected{% endif %}>Private</option>
                                    <option value="unlisted" {% if youtube_privacy == 'unlisted' %}selected{% endif %}>Unlisted</option>
                                    <option value="public" {% if youtube_privacy == 'public' %}selected{% endif %}>Public</option>
                                </select>
                                <small class="form-text text-muted">
                                    <strong>Private:</strong> Only you can view<br>
                                    <strong>Unlisted:</strong> Anyone with the link can view<br>
                                    <strong>Public:</strong> Anyone can search for and view
                                </small>
                            </div>
                            <div class="form-group">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="auto-create-playlists" {% if auto_create_playlists %}checked{% endif %}>
                                    <label class="custom-control-label" for="auto-create-playlists">Auto-Create Playlists</label>
                                </div>
                                <small class="form-text text-muted">Automatically create playlists for boat names that don't have a matching playlist</small>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Save YouTube Settings</button>
                            </div>
                        </form>
                        <div id="youtube-settings-alert" class="mt-3" style="display: none;"></div>
                    </div>
                    
                    <!-- Video Settings -->
                    <div class="settings-section">
                        <h4>Video Settings</h4>
                        <form id="video-settings-form">
                            <div class="form-group">
                                <label for="min-video-size">Minimum Video Size (MB):</label>
                                <input type="number" class="form-control" id="min-video-size" min="0" step="0.1" value="{{ min_video_size|default(1) }}">
                                <small class="form-text text-muted">
                                    Videos smaller than this size will be highlighted in red in the source videos list.
                                </small>
                            </div>
                            <div class="form-group">
                                <label for="max-video-size">Maximum Video Size (MB):</label>
                                <input type="number" class="form-control" id="max-video-size" min="0" step="1" value="{{ max_video_size|default(500) }}">
                                <small class="form-text text-muted">
                                    Videos larger than this size will be highlighted in orange in the source videos list.
                                </small>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Save Video Settings</button>
                            </div>
                        </form>
                        <div id="video-settings-alert" class="mt-3" style="display: none;"></div>
                    </div>
                    
                    <!-- Upload Throttling Settings -->
                    <div class="settings-section">
                        <h4>Upload Throttling</h4>
                        <form id="upload-settings-form">
                            <div class="form-group">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="throttling-enabled" {% if throttling_enabled %}checked{% endif %}>
                                    <label class="custom-control-label" for="throttling-enabled">Enable Upload Throttling</label>
                                </div>
                                <small class="form-text text-muted">Limit upload speed to avoid network congestion</small>
                            </div>
                            <div class="form-group">
                                <label for="max-upload-rate">Maximum Upload Speed (Mbps):</label>
                                <input type="number" class="form-control" id="max-upload-rate" min="0.1" step="0.1" value="{{ max_upload_rate|default(10.0) }}">
                                <small class="form-text text-muted">
                                    Limit the maximum upload speed in Megabits per second (Mbps).<br>
                                    For reference: 10 Mbps is approximately 1.25 MB/s
                                </small>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Save Upload Settings</button>
                            </div>
                        </form>
                        <div id="upload-settings-alert" class="mt-3" style="display: none;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js', v=version) }}"></script>
    <script src="{{ url_for('static', filename='js/rename-preview.js', v=version) }}"></script>
</body>
</html>
